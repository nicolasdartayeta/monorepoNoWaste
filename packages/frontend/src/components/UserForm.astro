---
interface Props {
  id?: string; // Optional for editing
  email?: string; // Optional for editing
  firstName?: string; // Optional for editing
  lastName?: string; // Optional for editing
  password?: string; // Optional for editing
}

// Destructure props with default empty values
const { id = '', email = '', firstName = '', lastName = '', password } = Astro.props;

---
<form class="p-6 bg-white rounded-lg shadow-md">
    <label for="email" class="block font-bold mb-2">Email:</label>
    <input
        type="email"
        name="email"
        id="email"
        value={email}
        placeholder="Ingresar email"
        class="border border-gray-300 rounded-md p-2 w-full mb-4"
        required
    />

    <label for="firstName" class="block font-bold mb-2">Nombre:</label>
    <input
        type="text"
        name="firstName"
        id="firstName"
        value={firstName}
        placeholder="Ingresar nombre"
        class="border border-gray-300 rounded-md p-2 w-full mb-4"
        required
    />

    <label for="lastName" class="block font-bold mb-2">Apellido:</label>
    <input
        type="text"
        name="lastName"
        id="lastName"
        value={lastName}
        placeholder="Ingresar apellido"
        class="border border-gray-300 rounded-md p-2 w-full mb-4"
        required
    />
    <label for="password" class="block font-bold mb-2">Contrasenia:</label>
    <input
        type="text"
        name="password"
        id="password"
        value={password}
        placeholder="Ingresar contrasenia"
        class="border border-gray-300 rounded-md p-2 w-full mb-4"
        required
    />

    <button
        type="submit"
        id="submit"
        class="bg-slate-500 py-2 px-4 text-white font-bold rounded-lg hover:bg-slate-600">
        {id ? 'Actualizar Usuario' : 'Agregar Usuario'}
    </button>
</form>

<script>
    import { app } from '@/lib/apiTreaty';

    document.querySelector('form')?.addEventListener('submit', async function (event) {
        event.preventDefault(); // Prevent default form submission

        // Collect form data
        const email = String((document.getElementById('email') as HTMLInputElement).value);
        const firstname = String((document.getElementById('firstName') as HTMLInputElement).value);
        const lastname = String((document.getElementById('lastName') as HTMLInputElement).value);
        const password = String((document.getElementById('password') as HTMLInputElement).value);
        const id = new URLSearchParams(window.location.search).get('id');;
        const userData = {
            id, // Optional ID for updating
            email,
            firstname,
            lastname,
            password,
        };

        console.log(userData); // For debugging
        try {
            let response;

            if (id) {
                // If user ID exists, update the existing user
                response = await app.user[':id'];
                //AGREGAR ENDPOINT EDIT USER
            } else {
                // If no user ID, create a new user entry
                response = await app.user.signup.client.post(userData);
                //AGREGAR ENDPOINT PARA AGREGAR USER
            }

            console.log(response);
            if (response.status === 200) {
                console.log('User successfully submitted:', response.data);
            }
        } catch (error) {
            console.error('Error submitting user:', error);
        }
    });
</script>